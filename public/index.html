<!DOCTYPE html>
<html>
  <head> <title> Titanic Visualization </title> </head>
  <body>
    <h1> Titanic Visualizations </h1>
    
    <div id="container">
    </div>
    <!-- <script src=""></script> -->
    <script>
      // ------------------------------------------------
      // Add some comments 
      fetch('titanic-passengers.json')
      .then(res => res.json())
      .then(json => {
        handleData(json)
      })
      .catch(err => console.log(err.message))

      // -------------------------------------------------
      // creates graph
      function makeGraph (data, filter, colors, width = 900, height = 400) {
        const container = document.createElement('div')
        container.style.width = `${width}px`
        container.style.height = `${height}px`
        
        const step = width / data.length * 2
        container.style.position = 'relative'

        for (let i = 0; i < data.length; i++) {
          const el = document.createElement('div')
          container.appendChild(el)
          el.style.position = 'absolute'
          if (data[i].sex === filter) {
            el.style.backgroundColor = colors[0]
          } else {
            el.style.backgroundColor = colors[1]
          }
          el.style.height = `${data[i].fare}px`
          el.style.width = `${step}px`
          el.style.left = `${step * i}px`
          el.style.bottom = '0'
        }
        return container
      }

      // -------------------------------------------------
      // creates graph
      function makeGraph2(data, width = 900, height = 400) {
        const container = document.createElement('div')
        container.style.width = `${width}px`
        container.style.height = `${height}px`
        
        const step = width / data.length * 2
        //!!
        container.style.position = 'relative'

        data.forEach((item, i) => {
          const el = document.createElement('div')
          container.appendChild(el)
          el.style.position = 'absolute'
          el.style.backgroundColor = item.color
          el.style.width = `${step}px`
          el.style.height = `${item.value}px`
          el.style.left = `${step * i}px`
          el.style.bottom = '0'
        });

        return container
      }

      // ----------------------------------
      // Handles data 
      function handleData(data) {
        const betterData = data.map(passengers => passengers.fields)
        // const allFares = betterData.map(fields => fields.fare).filter((fare) => {return fare !== undefined})
        // { fieldName: color, otherField: otherColor }
        // { men: 'blue', female: 'pink' }
        const passengersWithColors = betterData.map(passenger => {
          const value = passenger.fare
          const color = passenger.sex === 'male' ? '#3366ff' : 'pink'
          return { value, color } 
        })

        const passengersByAgeAndClass = betterData.map(passenger => {
          // Assignments 1
          // value is age
          // color is set by pclass (Must use Switch!)
          return { value, color } 
        })

        // Assignment 2 make up your own

        // Asignment Stretch challenge make up another 

        // const allPassengersFaresGraph = makeGraph(betterData, 'female', ['pink', '#3366ff'])
        const allPassengersFaresGraph = makeGraph2(passengersWithColors)
        document.querySelector('body').appendChild(allPassengersFaresGraph)

        const passengersAgeAndClassGraph = makeGraph2(passengersByAgeAndClass)
        document.querySelector('body').appendChild(passengersAgeAndClassGraph)
      }
    </script>
  </body>
</html>